import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.entity.Player;
import org.bukkit.plugin.java.JavaPlugin;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerJoinEvent;
import org.bukkit.event.player.PlayerQuitEvent;
import org.bukkit.scoreboard.*;

public class Lmcboard extends JavaPlugin implements Listener {

    private ScoreboardManager scoreboardManager;
    private Scoreboard scoreboard;
    private Objective objective;

    @Override
    public void onEnable() {
        // 初始化ScoreboardManager
        scoreboardManager = Bukkit.getScoreboardManager();
        scoreboard = scoreboardManager.getNewScoreboard();

        // 创建Objective
        objective = scoreboard.registerNewObjective("", "dummy");
        objective.setDisplayName(ChatColor.AQUA + "猫猫星球｜Lunchmc");
        objective.setDisplaySlot(DisplaySlot.SIDEBAR);

        // 注册事件监听器（自身）
        getServer().getPluginManager().registerEvents(this, this);

        // 设置所有现有玩家的计分板
        for (Player player : Bukkit.getOnlinePlayers()) {
            Score score = objective.getScore(player.getName());
            score.setScore(1); // 设置初始分数
            player.setScoreboard(scoreboard);
        }
    }

    @Override
    public void onDisable() {
        // 清理资源
        for (Player player : Bukkit.getOnlinePlayers()) {
            player.setScoreboard(Bukkit.getScoreboardManager().getMainScoreboard());
        }
    }

    // 事件处理
    @EventHandler
    public void onPlayerJoin(PlayerJoinEvent event) {
        Player player = event.getPlayer();
        Score score = objective.getScore(player.getName());
        score.setScore(1); // 设置初始分数
        player.setScoreboard(scoreboard);
    }

    @EventHandler
    public void onPlayerQuit(PlayerQuitEvent event) {
        Player player = event.getPlayer();
        player.setScoreboard(Bukkit.getScoreboardManager().getMainScoreboard());
    }
}