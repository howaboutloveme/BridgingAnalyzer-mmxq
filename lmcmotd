package com.example.lmcmotd;

import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.command.CommandEvent;
import org.bukkit.plugin.java.JavaPlugin;
import org.spigotmc.event.server.MotdInfoUpdateEvent;
import org.bukkit.ChatColor;

public class LmcMotd extends JavaPlugin implements Listener {

    @Override
    public void onEnable() {
        // Register this plugin as a listener for command events
        getServer().getPluginManager().registerEvents(this, this);
    }

    @EventHandler
    public void onCommandEvent(CommandEvent event) {
        Command command = event.getCommand();
        String commandLabel = command.getLabel();
        if (commandLabel.equalsIgnoreCase("lmcmotd")) {
            event.setCancelled(true); // Cancel the command execution
            CommandSender sender = event.getSender();
            if (sender.hasPermission("lmcmotd.command")) {
                // Change the server MOTD
                changeMotd(sender);
            } else {
                sender.sendMessage(ChatColor.RED + "你没有权限使用此命令!");
            }
        }
    }

    private void changeMotd(CommandSender sender) {
        // Set the new MOTD with color codes
        String motd = ChatColor.RED + "服务器" + "\n" + ChatColor.YELLOW + "欢迎游玩";
        // Update the MOTD
        updateMotd(motd);
        // Inform the sender
        sender.sendMessage(ChatColor.GREEN + "服务器的MOTD已更新!");
    }

    // Function to update the MOTD
    private void updateMotd(String motd) {
        // Paper specific way to update MOTD
        MotdInfoUpdateEvent motdEvent = new MotdInfoUpdateEvent(null, motd, null);
        getServer().getPluginManager().callEvent(motdEvent);
    }
}